<template>
    <c-form v-model="model" :schema="modelSchema"></c-form>
    <a-button @click="login">Submit</a-button>
</template>
<script>
export default {
    setup() {
        const webapi = inject("webapi");
        const token = inject("token");
        const router = useRouter();
        const model = reactive({
            username: null,
            password: null,
        });
        const modelSchema = {
            type: "object",
            properties: {
                username: {
                    type: "string",
                    title: "用户名",
                },
                password: {
                    type: "string",
                    title: "密码",
                    format:"password"
                },
            },
            title: "登录",
        };
        return {
            model,
            modelSchema,
            login() {
                const url = `${location.protocol}//${location.host}/api/dotnet/token?username=admin`;
                fetch(url, {
                    method: "POST",
                    credentials: "include",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                        "Cache-Control": "no-cache",
                    },
                    body: "username=admin",
                })
                    .then((o) => o.json())
                    .then((o) => {
                        token.access_token = o.access_token;
                        token.expiry = o.expires_in;
                        console.debug("登录成功，开始刷新token");
                        token.startRefresh();
                        router.push("/");
                    });
            },
        };
    },
};
</script>
